var t=function(){function t(){this._dataset=void 0,this._epsilon=void 0,this._minPts=void 0,this._clusters=void 0,this._noise=void 0,this._visited=void 0,this._assigned=void 0,this._datasetLength=0,this._dataset=[],this._epsilon=1,this._minPts=2,this._clusters=[],this._noise=[],this._visited=[],this._assigned=[],this._datasetLength=0}var s=t.prototype;return s.cluster=function(t,s){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this._dataset=t,this._clusters=[],this._noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}if(!s.minPts||"number"!=typeof s.minPts)throw Error("Minimum points must be defined and of type number (integer)");this._minPts=s.minPts,this._epsilon=s.epsilon?s.epsilon:this._getkNNDistPlotKnee(t,this._minPts);for(var i=0;i<this._datasetLength;i++)if(1!==this._visited[i]){this._visited[i]=1;var e=this._regionQuery(i);if(e.length<this._minPts)this._noise.push(i);else{var n=this._clusters.length;this._clusters.push([]),this._addToCluster(i,n),this._expandCluster(n,e)}}return this._clusters},s._kNNDistPlot=function(t,s){var i=this,e=[];return t.forEach(function(n,r){var h=[];t.forEach(function(t,s){r!==s&&h.push(i._haversineDistanceMeters(n,t))}),h.sort(function(t,s){return t-s}),e.push(h[s-1])}),e.sort(function(t,s){return s-t}),e},s._getkNNDistPlotKnee=function(t,s){var i=this._kNNDistPlot(t,s);if(console.log(i),t.length<3)throw new Error("Requires at least 3 data points to determine epsilon");if(3===t.length)return i[1];for(var e=0,n=0;n<i.length-1;n++)e+=i[n]-i[n+1];for(var r=e/i.length-1,h=[],a=0;a<i.length-1;a++)h.push(i[a]-i[a+1]>r);for(var o=Math.round(i.length/2),_=h.length,u=0;u<h.length-1;u++)if(h[u]||_--,_/h.length<3/4){o=u;break}return console.log(JSON.stringify(o)),i[o]},s._mergeArrays=function(t,s){for(var i=s.length,e=0;e<i;e++){var n=s[e];t.indexOf(n)<0&&t.push(n)}return t},s._haversineDistanceMeters=function(t,s){var i=function(t){return t*Math.PI/180},e=i(t[1]),n=i(t[0]),r=i(s[1]),h=r-e,a=i(s[0])-n,o=Math.sin(h/2)*Math.sin(h/2)+Math.cos(e)*Math.cos(r)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371e3},s._regionQuery=function(t){for(var s=[],i=0;i<this._datasetLength;i++)this._haversineDistanceMeters(this._dataset[t],this._dataset[i])<this._epsilon&&s.push(i);return s},s._expandCluster=function(t,s){for(var i=0;i<s.length;i++){var e=s[i];if(1!==this._visited[e]){this._visited[e]=1;var n=this._regionQuery(e);n.length>=this._minPts&&(s=this._mergeArrays(s,n))}1!==this._assigned[e]&&this._addToCluster(e,t)}},s._addToCluster=function(t,s){this._clusters[s].push(t),this._assigned[t]=1},t}();export default t;
//# sourceMappingURL=geodbscan.module.js.map
